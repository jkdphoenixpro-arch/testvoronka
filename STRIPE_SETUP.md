# Настройка Stripe для тестовых платежей

## 1. Регистрация в Stripe

1. Перейдите на https://stripe.com
2. Нажмите "Start now" или "Sign up"
3. Заполните форму регистрации
4. Подтвердите email

## 2. Получение API ключей

1. Войдите в Dashboard Stripe
2. Перейдите в раздел "Developers" → "API keys"
3. Скопируйте **Publishable key** (начинается с `pk_test_`)
4. Нажмите "Reveal test key" и скопируйте **Secret key** (начинается с `sk_test_`)

## 3. Настройка бэкенда

1. Перейдите в папку `backend`
2. Создайте файл `.env`:
```bash
cp .env.example .env
```

3. Откройте `.env` и вставьте ваши ключи:
```
STRIPE_SECRET_KEY=sk_test_ваш_секретный_ключ
STRIPE_PUBLISHABLE_KEY=pk_test_ваш_публичный_ключ
PORT=3001
CLIENT_URL=http://localhost:3000
```

## 4. Установка и запуск

### Бэкенд:
```bash
cd backend
npm install
npm run dev
```

### Фронтенд (в отдельном терминале):
```bash
npm start
```

## 5. Тестовые карты Stripe

Для тестирования используйте эти номера карт:

### Успешные платежи:
- **Visa**: `4242 4242 4242 4242`
- **Visa (debit)**: `4000 0566 5566 5556`
- **Mastercard**: `5555 5555 5555 4444`

### Отклоненные платежи:
- **Недостаточно средств**: `4000 0000 0000 9995`
- **Карта отклонена**: `4000 0000 0000 0002`

### Дополнительные данные для тестов:
- **CVC**: любые 3 цифры (например, `123`)
- **Дата истечения**: любая будущая дата (например, `12/25`)
- **Почтовый индекс**: любой (например, `12345`)

## 6. Создание продуктов в Stripe (опционально)

Если хотите создать продукты через Dashboard:

1. Перейдите в "Products" → "Add product"
2. Заполните информацию о продукте:
   - **Name**: название тарифа
   - **Description**: описание
3. В разделе "Pricing":
   - **Price**: цена в копейках (990 = 9.90 руб)
   - **Currency**: RUB
   - **Billing**: One time
4. Сохраните продукт

## 7. Тестирование

1. Запустите фронтенд и бэкенд
2. Перейдите на `/paywall`
3. Выберите тарифный план
4. Нажмите "Get my plan"
5. Используйте тестовую карту `4242 4242 4242 4242`
6. Заполните остальные поля любыми данными
7. Нажмите "Pay"

## 8. Проверка платежей

В Dashboard Stripe:
1. Перейдите в "Payments"
2. Увидите все тестовые транзакции
3. Можете просматривать детали каждого платежа

## 9. Webhook (для продакшена)

Для обработки событий Stripe в продакшене:

1. В Dashboard перейдите в "Developers" → "Webhooks"
2. Нажмите "Add endpoint"
3. URL: `https://ваш-домен.com/webhook`
4. Выберите события: `checkout.session.completed`

## Troubleshooting

### Ошибка CORS
Убедитесь, что в `.env` правильно указан `CLIENT_URL`

### Ошибка "Invalid API key"
Проверьте, что используете тестовые ключи (начинаются с `sk_test_` и `pk_test_`)

### Сервер не запускается
Убедитесь, что порт 3001 свободен или измените PORT в `.env`